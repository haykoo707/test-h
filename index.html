<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3QW0MCBKEC"></script>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://adsgram.io/static/adsgram.min.js"></script>
<script>
const adsgram = new Adsgram({
    blockId: '13855'
});

// ’ï÷Ä’´’∂’°’Ø’ù Watch Ad task-’´ ’Ø’∏’≥’°’Ø ’Ω’•’≤’¥’•’¨’´’Ω
function watchAdAndReward(taskId) {
    adsgram.show().then(() => {
        // ‘≥’∏’æ’°’¶’§’® ’§’´’ø’æ’•÷Å ’¥’´’∂’π÷á ’æ’•÷Ä’ª
        const task = tasks.find(t => t.id === taskId);
        if (task) {
            task.status = 'claimed';
            userScore += task.reward;
            permanentlyClaim(taskId);
            saveState();
            updateScore();
            renderTasks();
            alert(`+${task.reward} points earned!`);
        }
    }).catch(err => {
        console.log("Ad not completed", err);
    });
}
</script>

<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3QW0MCBKEC');
</script>

<title>HyperVerse</title>

<script>
  const tg = window.Telegram.WebApp;
  tg.expand(); // full screen
</script>


<style>
/* Popup animation */
.popup {
  display: none;
  position: fixed;
  z-index: 1000;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  animation: fadeIn 0.3s ease-in-out forwards;
}

.popup-content {
  background: #111;
  color: white;
  border: 1px solid #00f0ff;
  border-radius: 10px;
  padding: 20px;
  width: 90%;
  max-width: 350px;
  margin: 100px auto;
  text-align: center;
  font-family: sans-serif;
  animation: scaleIn 0.3s ease-in-out forwards;
  transform: scale(0.9);
  opacity: 0;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes scaleIn {
  0% {
    transform: scale(0.8);
    opacity: 0;
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}
</style>

</head>
<body>
</script>
<canvas id="starCanvas"></canvas>
  <div class="app-container">
    <!-- ’é’•÷Ä÷á’´ ’ø’∏’≤ -->
    <div class="top-bar">
      <div class="social-icons">
  
<!-- Welcome Bonus Popup -->
<div id="welcomePopup" class="popupbonus">
  <div class="popup-content">
    <h3>Welcome Bonus</h3>
    <p>Claim your +500  <i class="fas fa-star"></i>
 bonus for joining!</p>
    <button onclick="claimWelcomeBonus()">Claim</button>
  </div>
</div>
<script>
  // ’Ñ’´’°’æ’∏÷Ä’∂’•÷Ä’´ ’©’°÷Ä’¥’°÷Å’¥’°’∂ ÷Ü’∏÷Ç’∂’Ø÷Å’´’°
function updateScore() {
  document.getElementById('userScore').textContent = userScore;
  localStorage.setItem('userScore', userScore);
  document.getElementById('userScoreDisplay').innerHTML = `${formatScore(userScore)} <i class="fas fa-star"></i>`;
  updateMedals();

  // ‚¨áÔ∏è ’Ü’∏÷Ä ’°’æ’•’¨’°÷Å’∏÷Ç’¥
  sendScoreToServer();
}


function claimWelcomeBonus() {
  userScore += 500;
  updateScore();
  localStorage.setItem("welcomeBonusClaimed", "true");

  const popup = document.getElementById("welcomePopup");
  popup.querySelector('.popup-content').style.animation = "popupFadeOut 0.4s ease forwards";

  setTimeout(() => {
    popup.style.display = "none";
  }, 400); // same duration as the animation
}
window.addEventListener("load", () => {
  const claimed = localStorage.getItem("welcomeBonusClaimed");
  if (!claimed) {
    document.getElementById("welcomePopup").style.display = "block";
  }
});


</script>

        



        </script>
        
      </div>
      <div class="title"></div>
      <i class="fas fa-star"></i>
      <div class="score">
        <i class="fas fa-star"></i>
         <span id="userScore">ùü¨
        </span>
      </div>
    </div>
    <!-- Tabs ’¢’°’™’´’∂ -->
    <div class="tabs">
    </button>
    <button class="tab-button active" data-tab="play">
<img src="https://raw.githubusercontent.com/haykoo707/hypervverse/refs/heads/main/Picsart_25-03-28_20-51-07-122.jpg" alt="play-xax" class="play-icon">
</button>
      <button class="tab-button" data-tab="home">
        <img src="https://raw.githubusercontent.com/haykoo707/hypervverse/refs/heads/main/Picsart_25-03-28_20-52-07-873.jpg" alt="Tasks" class="tasks-icon">
        
      <button class="tab-button" data-tab="profile">
        <img src="https://raw.githubusercontent.com/haykoo707/hypervverse/refs/heads/main/Picsart_25-03-28_20-52-49-352.jpg" alt="Profile" class="profile-icon">
      </button>
    </div>
    <!-- ‘≤’∏’æ’°’∂’§’°’Ø’∏÷Ç’©’µ’°’∂ ’Ø’∏’∂’ø’•’µ’∂’•÷Ä -->
    <div class="content">
      <!-- Home Tab (Tasks) -->
      <div id="home" class="tab-content">
        <div class="task-section">
          <h2 class="taskstxt">
            <i class="fas fa-tasks"></i> 
            Tasks
          </h2>
          
                    <div class="task-list" id="taskList">
            <!-- Tasks ’∂’•÷Ä’¥’∏÷Ç’Æ’æ’∏÷Ç’¥ ’•’∂ JS-’∏’æ -->
          </div>
        </div>
      </div>

      
  

    
      <!-- profile Tab -->
      <div id="profile" class="tab-content">
        <div class="profile-section">
          <div class="profile-info" id="profileInfo"></div>
          <div id="connect" style="
          margin-top: 20px;  
        padding: p15x;
        border-radius: 8px;
        position: absolute;
        left: 50%; 
        transform: translateX(-50%);"></div> 
        </div>
      </div>


 <script>
  window.Telegram.WebApp.ready();

  // User data
  let user = window.Telegram.WebApp.initDataUnsafe?.user;

  // ‘µ’©’• browser-’∏’æ ’¢’°÷Å’æ’´ ‚Üí demo user
  if (!user) {
    user = {
      id: 123456789,
      first_name: "Demo",
      last_name: "User",
      username: "demo_user",
      photo_url: "https://i.pravatar.cc/150?img=8"
    };
  }

  const profileDiv = document.getElementById("profileInfo");

  profileDiv.innerHTML = `
    <div style="
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px;
      background:#1e1e1e;
      border-radius:14px;
      box-shadow:0 4px 10px rgba(0,0,0,0.5);
      color:#fff;
      border-top:2px solid #fff; 
      margin-top:-26px;
    ">
      <img src="${user.photo_url || ''}" 
           alt="Profile Photo" 
           style="width:80px;height:80px;border-radius:50%;object-fit:cover;;${user.photo_url ? '' : 'display:none;'}">
      <div style="flex:1;">
        <h3 style="margin:0;font-size:18px;color:#fff;">${user.first_name} ${user.last_name || ''}</h3>
        <p style="margin:3px 0; color:#aaa;">@${user.username || '‚Äî'}</p>
        <p style="margin:3px 0; font-size:14px; color:#777;">ID: ${user.id}</p>
      </div>
    </div>
  `;
</script>

</script>

<!-- Play Tab -->
<div id="play" class="tab-content active">
  <div class="score-container">
<div class="score-icon">
  <img src="ChatGPT Image Aug 20, 2025, 10_39_44 PM.png" alt="Paw Icon" class="score-image" />
</div>
    <div class="score-text" id="userScoreDisplay">0</div>
    <div id="medalsContainer" onclick="openRewardPopup()"></div>
      <div class="button-group">
       <button class="btn farmingbtn" onclick="window.location.href='mining.html'">
                <i class="fas fa-seedling icon"></i>
                Start Farming
            </button>
            
            <button class="btn spinbtn" onclick="window.location.href='spin.html'">
                <i class="fas fa-sync-alt icon"></i>
                Spin
            </button>





  </div>
</div>
  </div>
</div>


<script>
  // ’ì’∏’≠’°÷Ä’´’∂’´÷Ä ÷Ñ’∏ setupTabs() ÷Ü’∏÷Ç’∂’Ø÷Å’´’°’∂ ’Ω÷Ä’°’∂’∏’æ

function setupTabs() {
  const tabButtons = document.querySelectorAll('.tab-button');
  const tabContents = document.querySelectorAll('.tab-content');
  
  tabButtons.forEach(button => {
    button.addEventListener('click', () => {
      // Ripple ’ß÷Ü’•’Ø’ø
      button.classList.add('clicked');
      setTimeout(() => button.classList.remove('clicked'), 500);
      
      // ‘≥’ø’∂’•’¨ ’∂’•÷Ä’Ø’°’µ’´’Ω active content
      const currentActive = document.querySelector('.tab-content.active');
      const targetTab = button.getAttribute('data-tab');
      const targetContent = document.getElementById(targetTab);
      
      // ‘µ’©’• ’∂’∏÷Ç’µ’∂ tab-’∂ ’ß’ù return
      if (currentActive === targetContent) return;
      
      // ’ç’Ø’Ω’•’¨ transition
      if (currentActive) {
        currentActive.classList.add('slide-out');
        
        setTimeout(() => {
          // ’Ä’°’∂’•’¨ active-’® ’¢’∏’¨’∏÷Ä content-’∂’•÷Ä’´÷Å
          tabContents.forEach(tc => {
            tc.classList.remove('active', 'slide-out');
          });
          
          // ‘±’æ’•’¨’°÷Å’∂’•’¨ active ’∂’∏÷Ä’´’∂
          if (targetContent) {
            targetContent.classList.add('active');
          }
        }, 300); // slide-out ’ø÷á’∏’≤’∏÷Ç’©’µ’∏÷Ç’∂’®
      } else {
        // ‘µ’©’• ’∏’π ’¥’´ active ’π’Ø’°, ’∏÷Ç’≤’≤’°’Ø’´ ÷Å’∏÷Ç’µ÷Å ’ø’°’¨
        tabContents.forEach(tc => tc.classList.remove('active'));
        if (targetContent) {
          targetContent.classList.add('active');
        }
      }
      
      // Button active states
      tabButtons.forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');
    });
    
    // Touch feedback mobile-’´ ’∞’°’¥’°÷Ä
    button.addEventListener('touchstart', () => {
      button.style.transform = 'translateY(-1px) scale(0.98)';
    });
    
    button.addEventListener('touchend', () => {
      setTimeout(() => {
        if (button.classList.contains('active')) {
          button.style.transform = 'translateY(-1px) scale(1.1)';
        } else {
          button.style.transform = '';
        }
      }, 100);
    });
  });
}

// ‘ø’°÷Ä’∏’≤ ’•’Ω ’°’æ’•’¨’°÷Å’∂’•’¨ ’∂’°÷á smooth page loading ’ß÷Ü’•’Ø’ø
document.addEventListener('DOMContentLoaded', () => {
  // ’ç’Ø’¶’¢’∂’°’Ø’°’∂ active tab-’´ ’°’∂’´’¥’°÷Å’´’°
  const initialActive = document.querySelector('.tab-content.active');
  if (initialActive) {
    initialActive.style.opacity = '0';
    initialActive.style.transform = 'translateY(20px)';
    
    setTimeout(() => {
      initialActive.style.opacity = '1';
      initialActive.style.transform = 'translateY(0)';
    }, 100);
  }
});
 function updateMedals() {
  const medals = [
    { score: 100, emoji: '<i class="fas fa-medal" style="color: #cd7f32;"></i>', label: 'Bronze Medal' },
    { score: 10000, emoji: '<i class="fas fa-medal" style="color: #c0c0c0;"></i>', label: 'Silver Medal' },
    { score: 50000, emoji: '<i class="fas fa-medal" style="color: #ffd700;"></i>', label: 'Gold Medal' },
    { score: 150000, emoji: '<i class="fas fa-trophy" style="color: #e5e4e2;"></i>', label: 'Platinum Medal' },
    { score: 500000, emoji: '<i class="fas fa-gem" style="color: #b9f2ff;"></i>', label: 'Diamond Medal' },
    { score: 1000000, emoji: '<i class="fas fa-trophy" style="color: gold;"></i>', label: 'Millionaire Medal' },
    { score: 5000000, emoji: '<i class="fas fa-crown" style="color: #ffd700;"></i>', label: 'Legend Medal' },
    { score: 10000000, emoji: '<i class="fas fa-infinity" style="color: #4b0082;"></i>', label: 'God Mode Medal' }
  ];

  const current = [...medals].reverse().find(m => userScore >= m.score);
  const medalsContainer = document.getElementById("medalsContainer");

  medalsContainer.innerHTML = current
    ? `<div class="medals-container">
         <div class="medal">
           <span class="medal-emoji">${current.emoji}</span>
           <span class="medal-label">${current.label}</span>
         </div>
       </div>`
    : '<p style = "font-size:18px">No title earned yet.</p>';
}

// ’ç’ø’°÷Å’´÷Ä userScore localStorage-’´÷Å
const score = parseInt(localStorage.getItem('userScore')) || 0;

// ’Å÷á’°’π’°÷É’∏÷Ç’¥
function formatScore(num) {
    if (num >= 1e6) return (num / 1e6).toFixed(2) + "M";
    if (num >= 1e3) return (num / 1e3).toFixed(2) + "K";
    return num.toString();
}


// ‘≥’ø’´÷Ä ’¥’•’§’°’¨’® ’®’Ω’ø ’¥’´’°’æ’∏÷Ä’´ (’°’¥’•’∂’°’¢’°÷Ä’±÷Ä’´’∂ ’∞’°’¥’°’∫’°’ø’°’Ω’≠’°’∂’∏’≤’®)
const currentMedal = medals.reverse().find(medal => score >= medal.score);

// ‘π’°÷Ä’¥’°÷Å÷Ä’∏÷Ç ÷Å’∏÷Ç÷Å’°’§÷Ä’∏÷Ç’¥’®
document.getElementById("userScoreDisplay").innerHTML = `
  ${formatScore(score)} <i class="fas fa-star"></i>
`;


</script>

<!-- History Popup -->
<div id="historyPopup" class="history-popup">
  <div class="history-popup-content">
    <div class="history-header">
      <h2><i class="fas fa-history"></i> Score History</h2>
      <button id="closeHistoryBtn" class="close-history-btn"><i class="fas fa-times"></i></button>
    </div>
    <div id="historyList" class="history-list">
      <!-- History items will be populated here -->
    </div>
  </div>
</div>

<div class="loading-screen" id="loadingScreen">
  <img src="ChatGPT Image Aug 19, 2025, 04_38_33 PM.png" alt="Loading..." class="loading-image animate-loading">
  <h5 class="loadingh5">0.1v</h5> 
</div>


<!-- ‘¥÷Ä’° ’∞’°’¥’°÷Ä ’ø’•’≤’°’§÷Ä’´÷Ä ’Ω’° ÷Ñ’∏ body-’´ ’æ’•÷Ä’ª’∏÷Ç’¥ -->
<div id="notification" class="notification hidden">
  <span class="check">‚úîÔ∏è</span>
  <span>You got +100<i class="fas fa-star"></i></span>
</div>

<div id="notification" class="notification hidden"></div>
<div id="notification" class="notification hidden"></div>




<script>
    // ’ç’ø’∏÷Ç’£’•’¨, ’°÷Ä’§’µ’∏÷Ñ ’Ø’°’µ÷Ñ’® ’¢’°÷Å’æ’°’Æ ’ß Telegram-’´ ’¥’•’ª
    function checkTelegramContext() {
        if (window.Telegram && Telegram.WebApp) {
            Telegram.WebApp.ready(); // ‘±’Ø’ø’´’æ’°÷Å’∂’•’¨ WebApp-’®
            Telegram.WebApp.expand(); // ‘∏’∂’§’¨’°’µ’∂’•’¨ ’ß’Ø÷Ä’°’∂’®
        } else {
            // ’à’π Telegram ’¥’´’ª’°’æ’°’µ÷Ä’∏÷Ç’¥ ’ß
            window.location.href = "https://t.me/hyperrverse_bot"; // ’ì’∏’≠’°÷Ä’´’∂’•’¨ ’±’•÷Ä ’¢’∏’ø’´ ’∞’≤’∏÷Ç’¥’∏’æ
            // ‘ø’°’¥ ÷Å’∏÷Ç’µ÷Å ’ø’°’¨ ’Ω’≠’°’¨’´ ’∞’°’≤’∏÷Ä’§’°’£÷Ä’∏÷Ç’©’µ’∏÷Ç’∂
            // document.body.innerHTML = "<h1>’Ñ’∏÷Ç’ø÷Ñ’® ’¥’´’°’µ’∂ Telegram-’´ ’¥’´’ª’∏÷Å’∏’æ</h1>";
        }
    }

    // ’ç’Ø’¶’¢’∂’°’æ’∏÷Ä’•’¨ ’Ω’ø’∏÷Ç’£’∏÷Ç’¥’®
    checkTelegramContext();
</script>

  <script>
    
    const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://haykoo707.github.io/hypervverse/tonconnect-manifest.json',
            buttonRootId: 'connect'
            
        });
        async function transaction() {
        const transaction = {
            validUntil: Math.round(Date.now() / 1000) + 10,
            messages: [
                {
                    address: "UQBfrU75WGhBLnRpBs1ImWE5sPdxKsFMBgogpD578JxXyDbK",
                    amount: "1000000" // Example amount in nanoton
                }
            ]
        };

    try {
        await tonConnectUI.sendTransaction(transaction);
        console.log("Transaction sent successfully!");
    } catch (e) {
        console.error("Failed to send transaction:", e);
    }
}
</script>
  <script>
      setTimeout(() => {
          document.getElementById("loadingScreen").style.opacity = "0";
          setTimeout(() => {
              document.getElementById("loadingScreen").style.display = "none";
          }, 3000);
      }, 1900);
  </script>

  <script>
  
    // ’ï’£’ø’°’ø’´÷Ä’∏’ª ’¥’´’°’æ’∏÷Ä’∂’•÷Ä’® (’∞’•’º’•’¨’∏’æ ’Ω’Ø’¶’¢’∂’°’Ø’°’∂ ’°÷Ä’™’•÷Ñ’® localStorage-’´÷Å, ’•’©’• ’Ø’°’∂)
   
    const playButton = document.querySelector('.play-btn');
const closeButton = document.querySelector('.close-btn');
const ball = document.getElementById('ball');
const scoreDisplay = document.getElementById('score');
// ’ç’ø’•’≤’Æ’∏÷Ç’¥ ’•’∂÷Ñ bonus ’ß’¨’•’¥’•’∂’ø’®
let bonus = document.createElement('div');
bonus.id = 'bonus';
bonus.classList.add('hidden');
const dailyCode = "1234"; // ‚úÖ ’ì’∏’≠’°÷Ä’´’∂’´÷Ä ÷Ñ’∏ ÷Ö÷Ä’æ’° ’Ø’∏’§’∏’æ
const questCooldownKey = "dailyQuestCooldown";
const userScoreKey = "userScore"; // üî• ’ä’°’∞’∏÷Ç’¥ ’•’∂÷Ñ score Local Storage-’∏÷Ç’¥



// Constants
const TASKS_VERSION = '1.0'; // Add version control for potential future updates
const HISTORY_KEY = 'scoreHistory'; // Key for storing history in localStorage

// Score history tracking


let scoreHistory = [];
// ’ç’Ø’¶’¢’∂’°’Ø’°’∂ tasks-’•÷Ä’®

/**
 * Load score history from localStorage
 */
 function loadScoreHistory() {
  const savedHistory = localStorage.getItem(HISTORY_KEY);
  if (savedHistory) {
    try {
      scoreHistory = JSON.parse(savedHistory);
    } catch (e) {
      console.error("Error parsing score history:", e);
      scoreHistory = [];
    }
  }
}

/**
 * Save score history to localStorage
 */
function saveScoreHistory() {
  localStorage.setItem(HISTORY_KEY, JSON.stringify(scoreHistory));
}

/**
 * Add a score change to history
 * @param {number} amount - The amount to change (positive or negative)
 * @param {string} description - Description of the change
 */
function addToHistory(amount, description) {
  // Create history entry
  const entry = {
    timestamp: Date.now(),
    amount: amount,
    description: description
  };
  
  // Add to history array
  scoreHistory.push(entry);
  
  // Keep history at a reasonable size (last 100 entries)
  if (scoreHistory.length > 100) {
    scoreHistory = scoreHistory.slice(-100);
  }
  
  // Save to localStorage
  saveScoreHistory();
}

/**
 * Format date for display in history
 */
function formatDate(timestamp) {
  const date = new Date(timestamp);
  return `${date.toLocaleDateString()} ${date.toLocaleTimeString()}`;
}

/**
 * Show history popup
 */
function showHistoryPopup() {
  const historyPopup = document.getElementById('historyPopup');
  const historyList = document.getElementById('historyList');
  
  // Clear previous content
  historyList.innerHTML = '';
  
  if (scoreHistory.length === 0) {
    historyList.innerHTML = '<div class="history-empty">No history available</div>';
  } else {
    // Sort history by timestamp (newest first)
    const sortedHistory = [...scoreHistory].sort((a, b) => b.timestamp - a.timestamp);
    
    // Create history items
    sortedHistory.forEach(entry => {
      const historyItem = document.createElement('div');
      historyItem.classList.add('history-item');
      historyItem.classList.add(entry.amount >= 0 ? 'plus' : 'minus');
      
      const amountText = entry.amount >= 0 ? `+${entry.amount}` : `${entry.amount}`;
      
      historyItem.innerHTML = `
        <div>
          <div class="details">${entry.description}</div>
          <div class="timestamp">${formatDate(entry.timestamp)}</div>
        </div>
        <div class="amount ${entry.amount >= 0 ? 'plus' : 'minus'}">
          ${amountText} <i class="fas fa-star"></i>
        </div>
      `;
      
      historyList.appendChild(historyItem);
    });
  }
  
  // Show popup
  historyPopup.classList.add('active');
}

/**
 * Close history popup
 */
function closeHistoryPopup() {
  const historyPopup = document.getElementById('historyPopup');
  historyPopup.classList.remove('active');
}

// Set up close button handler for history popup
document.getElementById('closeHistoryBtn').addEventListener('click', closeHistoryPopup);

const defaultTasks = [
{
    id: 1,
    title: 'Join Telegram Channel',
    icon: '<i class="fab fa-telegram-plane" style="color: #ffffffef; font-size: 1.5em;"></i>',
    link: 'https://t.me/HyperrVersee',
    reward: 2000,
    status: 'pending',
    claimAvailable: false,
    timerId: null
},
{
    id: 2,
    title: 'Join X Community',
    link: 'https://x.com/HyperVerse_TG',
    reward: 2000,
    status: 'pending',
    claimAvailable: false,
    timerId: null,
    icon: '<i class="fa-brands fa-x-twitter" style="color: #ffffffef; font-size: 1.4em;"></i>'
},
{
    id: 4,
    title: 'Follow TikTok',
    link: 'https://www.tiktok.com/@hyper_verse_', // ’ì’∏’≠’°÷Ä’´’∂’´÷Ä ’´÷Ä’°’Ø’°’∂ ’∞’≤’∏÷Ç’¥’∏’æ
    reward: 2000,
    status: 'pending',
    claimAvailable: false,
    timerId: null,
    icon: '<i class="fab fa-tiktok" style="color: #ffffffef; font-size: 1.4em;"></i>'
},
{
    id: 5,
    title: 'Verify Telegram Premium',
    link: '',
    reward: 5000,
    status: 'pending',
    claimAvailable: false,
    timerId: null,
    icon: '<i class="fas fa-crown"  style="color: #ffffffef; font-size: 1.4em;"></i>'
},
{
    id: 6,
    title: '3-Day Reward Streak',
    link: '',
    reward: 3000,
    status: 'pending',
    claimAvailable: false,
    timerId: null,
    icon: '<i class="fas fa-gift"  style="color: #ffffffef; font-size: 1.4em;"></i>'

},
{
    id: 7,
    title: '5-Day Reward Streak',
    link: '',
    reward: 5000,
    status: 'pending',
    claimAvailable: false,
    timerId: null,
    icon: '<i class="fas fa-gift"  style="color: #ffffffef; font-size: 1.4em;"></i>'
},
{
    id: 8,
    title: '10-Day Reward Streak',
    link: '',
    reward: 10000,
    status: 'pending',
    claimAvailable: false,
    timerId: null,
    icon: '<i class="fas fa-gift"  style="color: #ffffffef; font-size: 1.4em;"></i>'
},
{
    id: 9,
    title: 'Boost Our Channel ',
    link: '',
    reward: 500,
    status: 'pending',
    claimAvailable: false,
    timerId: null,
    icon: '<i class="fas fa-bolt"  style="color: #ffffffef; font-size: 1.4em;"></i>'
},
{
    id: 10,
    title: 'User Verification',
    link: '',
    status: 'pending',
    claimAvailable: false,
    timerId: null,
    icon: '<i class="fas fa-circle-check"  style="color: #ffffffef; font-size: 1.4em;"></i>'
},
{
    id: 11,
    title: 'Watch an Ad',
    reward: 1000,
    status: 'pending',
    claimAvailable: false,
    timerId: null,
    icon: '<i class="fas fa-play-circle" style="color: #ffffffef; font-size: 1.4em;"></i>',
    type: 'ad'
}

];
function trackLoginDay() {
    const today = new Date().toDateString();
    let loginDays = JSON.parse(localStorage.getItem("loginDays") || "[]");

    // ‘µ’©’• ’°’µ’Ω÷Ö÷Ä’æ’° ÷Ö÷Ä’® ’§’•’º ’π’Ø’°’ù ’°’æ’•’¨’°÷Å’∂’•’∂÷Ñ
    if (!loginDays.includes(today)) {
        loginDays.push(today);
        localStorage.setItem("loginDays", JSON.stringify(loginDays));
    }
}

// ’î’°’∂’´ ’°’∂’£’°’¥ ’≠’°’≤’® ’¢’°÷Å’•’∂’ù ’£÷Ä’°’∂÷Å’´ ÷Ö÷Ä’®
trackLoginDay();

// Global variables
let tasks = [];
let userScore = 0;
let taskUpdateListener = null; // Used to detect changes to defaultTasks

/**
 * Save the current state to localStorage
 */
function saveState() {
    // Save user score
    localStorage.setItem('userScore', userScore);
    
    // Save current tasks state
    localStorage.setItem('tasks', JSON.stringify(tasks));
    
    // Save a separate list of permanently claimed task IDs
    const claimedTaskIds = JSON.parse(localStorage.getItem('claimedTaskIds') || '[]');
    localStorage.setItem('claimedTaskIds', JSON.stringify(claimedTaskIds));
    
    // Save the current version
    localStorage.setItem('tasksVersion', TASKS_VERSION);
}

/**
 * Permanently mark a task as claimed
 */
function permanentlyClaim(taskId) {
    // Get current list of claimed tasks
    const claimedTaskIds = JSON.parse(localStorage.getItem('claimedTaskIds') || '[]');
    
    // Add this task ID if not already in the list
    if (!claimedTaskIds.includes(taskId)) {
        claimedTaskIds.push(taskId);
        localStorage.setItem('claimedTaskIds', JSON.stringify(claimedTaskIds));
    }
}

/**
 * Load the state from localStorage
 */
function loadState() {
    // Get saved data
    const savedVersion = localStorage.getItem('tasksVersion');
    const savedScore = localStorage.getItem('userScore');
    const savedTasks = localStorage.getItem('tasks');
    const claimedTaskIds = JSON.parse(localStorage.getItem('claimedTaskIds') || '[]');
    
    // Restore user score if available
    if (savedScore !== null) {
        userScore = parseInt(savedScore, 10);
    }
    
    // Always start with the current defaultTasks (to catch any changes to it)
    // but filter out the claimed tasks
    const currentTasks = defaultTasks
        .filter(task => !claimedTaskIds.includes(task.id))
        .map(task => ({...task})); // Create copies to avoid modifying defaults
    
    // Then, merge any saved task state for tasks that still exist
    if (savedTasks !== null) {
        const savedTasksArray = JSON.parse(savedTasks);
        
        // For each saved task that still exists in defaultTasks, preserve its state
        savedTasksArray.forEach(savedTask => {
            const matchingTaskIndex = currentTasks.findIndex(t => t.id === savedTask.id);
            if (matchingTaskIndex >= 0 && !claimedTaskIds.includes(savedTask.id)) {
                // Preserve the state (status, timers, etc.) but keep any updated properties
                // from the default tasks (like title, icon, etc.)
                currentTasks[matchingTaskIndex] = {
                    ...currentTasks[matchingTaskIndex],
                    status: savedTask.status,
                    claimAvailable: savedTask.claimAvailable,
                    timerId: null // Don't restore timers from localStorage
                };
            }
        });
    }
    
    // Use the merged task list
    tasks = currentTasks;
    
    // Reset any tasks that were left in "started" state
    tasks.forEach(task => {
        if (task.status === 'started') {
            task.status = 'pending';
            task.claimAvailable = false;
            if (task.timerId) {
                clearTimeout(task.timerId);
                task.timerId = null;
            }
        }
    });
    
    // Save the initialized state
    saveState();
    
    // Update UI
    updateScore();
    renderTasks();
}

/**
 * Update the score display
 */
function updateScore() {
    const scoreElement = document.getElementById('userScore');
    if (scoreElement) {
        scoreElement.textContent = userScore;
    

    document.getElementById('userScoreDisplay').innerHTML = `${formatScore(userScore)} <i class="fas fa-star"></i>`;

}
}

/**
 * Show a notification
 */
function showNotification(message) {
    const notificationContainer = document.getElementById('notificationContainer');
    if (!notificationContainer) {
        // Create notification container if it doesn't exist
        const container = document.createElement('div');
        container.id = 'notificationContainer';
        container.style.position = 'fixed';
        container.style.top = '20px';
        container.style.right = '20px';
        container.style.zIndex = '1000';
        document.body.appendChild(container);
    }
    
    const notification = document.createElement('div');
    notification.classList.add('notification');
    notification.innerHTML = message;
    notification.style.backgroundColor = '#4CAF50';
    notification.style.color = 'white';
    notification.style.padding = '12px 20px';
    notification.style.margin = '5px 0';
    notification.style.borderRadius = '4px';
    notification.style.boxShadow = '0 2px 5px rgba(0,0,0,0.2)';
    notification.style.opacity = '0';
    notification.style.transition = 'opacity 0.3s';
    
    document.getElementById('notificationContainer').appendChild(notification);
    
    // Show notification
    setTimeout(() => {
        notification.style.opacity = '1';
    }, 10);
    
    // Remove notification after 3 seconds
    setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => {
            notification.remove();
        }, 300);
    }, 3000);
}

/**
 * Render the task list
 */
function renderTasks() {
    const taskList = document.getElementById('taskList');
    if (!taskList) return;
    
    taskList.innerHTML = '';
    
    // Only show tasks that aren't claimed
    tasks.forEach(task => {
        const taskItem = document.createElement('div');
        taskItem.classList.add('task-item');
        
        // Left part: Icon, Title, Reward
        const taskLeft = document.createElement('div');
        taskLeft.classList.add('task-left');
        
        const iconDiv = document.createElement('div');
        iconDiv.classList.add('task-icon');
        // ’Ä’´’∂ ’Ø’∏’§
if (task.icon && task.icon.startsWith('http')) {
    const img = document.createElement('img');
    img.src = task.icon;
    img.style.width = '24px';
    img.style.height = '24px';
    iconDiv.appendChild(img);
} else {
    iconDiv.innerHTML = task.icon || ''; // ’ì’∏’≠’æ’°’Æ ’ß textContent ‚Üí innerHTML
}
        
        const taskInfo = document.createElement('div');
        taskInfo.classList.add('task-info');
        
        const taskTitle = document.createElement('div');
        taskTitle.classList.add('task-title');
        taskTitle.textContent = task.title;
        
        const taskReward = document.createElement('div');
        taskReward.classList.add('task-reward');
        taskReward.innerHTML = `+${task.reward} <i class="fas fa-star"></i>`;
        
        taskInfo.appendChild(taskTitle);
        taskInfo.appendChild(taskReward);
        taskLeft.appendChild(iconDiv);
        taskLeft.appendChild(taskInfo);
        
        // Right part: Action button
        const taskRight = document.createElement('div');
        taskRight.classList.add('task-right');
        const actionBtn = document.createElement('button');
        
        if (task.status === 'pending') {
            actionBtn.textContent = 'Start';
            actionBtn.classList.add('start-btn');
            actionBtn.addEventListener('click', () => handleStart(task.id));
        } else if (task.status === 'started') {
            if (!task.claimAvailable) {
                actionBtn.textContent = 'Wait...';
                actionBtn.classList.add('waiting-btn');
                actionBtn.disabled = true;
            } else {
                actionBtn.textContent = 'Claim';
                actionBtn.classList.add('claim-btn');
                actionBtn.addEventListener('click', () => handleClaim(task.id));
            }
        }
        
        taskRight.appendChild(actionBtn);
        taskItem.appendChild(taskLeft);
        taskItem.appendChild(taskRight);
        taskList.appendChild(taskItem);
    });
    
    // Show a message if no tasks are available
    if (tasks.length === 0) {
        const noTasksMessage = document.createElement('div');
        noTasksMessage.classList.add('no-tasks-message');
        noTasksMessage.textContent = 'All tasks completed!';
        noTasksMessage.style.textAlign = 'center';
        noTasksMessage.style.padding = '20px';
        noTasksMessage.style.color = '#666';
        taskList.appendChild(noTasksMessage);
    }
}

/**
 * Handle the Start button click
 */
function handleStart(taskId) {
    const task = tasks.find(t => t.id === taskId);
    if (!task) return;


// ‚úÖ Adsgram Watch Ad Task
if (task.type === 'ad' || task.id === 11) {
    adsgram.show().then(() => {
        task.status = 'claimed';
        userScore += task.reward;
        permanentlyClaim(task.id);
        updateScore();
        addToHistory(task.reward, `Watched Ad: ${task.title}`);
        saveScoreHistory();
        saveState();
        renderTasks();
        showNotification(`+${task.reward} <i class="fas fa-star"></i> earned from ad!`);
    }).catch(err => {
        console.log("Ad not completed", err);
    });
    return;
}
    // ‚úÖ Premium Check Task
    if (task.id === 5) {
        const isPremium = Telegram.WebApp.initDataUnsafe?.user?.is_premium;
        if (isPremium) {
            task.status = 'started';
            task.claimAvailable = true;
            renderTasks();
            saveState();
        } else {
            showNotification("‚ùå Premium only task. Please upgrade your Telegram account.");
        }
        return;
    }

    // ‚úÖ Daily Reward 3-Day Streak Task
    if (task.id === 6) {
        const claimDays = JSON.parse(localStorage.getItem("dailyClaimDays") || "[]");

        // Convert to Date objects
        const dates = claimDays.map(d => new Date(d));

        if (dates.length < 3) {
            showNotification("‚ùå You need 3 daily rewards in a row!");
            return;
        }

        // ’é’•÷Ä’ª’´’∂ 3 ÷Ö÷Ä’•÷Ä’® sort-’•’∂÷Ñ ÷á ’Ω’ø’∏÷Ç’£’•’∂÷Ñ’ù ’°’∂’®’∂’§’¥’•’ª ’•’∂?
        dates.sort((a, b) => a - b);

        const day1 = dates[0];
        const day2 = dates[1];
        const day3 = dates[2];

        function isConsecutive(d1, d2) {
            return (d2 - d1) / (1000 * 60 * 60 * 24) === 1;
        }

        if (isConsecutive(day1, day2) && isConsecutive(day2, day3)) {
            task.status = 'started';
            task.claimAvailable = true;
            renderTasks();
            saveState();
        } else {
            showNotification("You need to collect daily rewards 3 days in a row!");
        }

        return;
    }
     // ‚úÖ Daily Reward 5-Day Streak Task
    if (task.id === 7) {
        const claimDays = JSON.parse(localStorage.getItem("dailyClaimDays") || "[]");

        // Convert to Date objects
        const dates = claimDays.map(d => new Date(d));

        if (dates.length < 5) {
            showNotification("‚ùå You need 5 daily rewards in a row!");
            return;
        }

        // ’é’•÷Ä’ª’´’∂ 5 ÷Ö÷Ä’•÷Ä’® sort-’•’∂÷Ñ ÷á ’Ω’ø’∏÷Ç’£’•’∂÷Ñ’ù ’°’∂’®’∂’§’¥’•’ª ’•’∂?
        dates.sort((a, b) => a - b);

        const day1 = dates[0];
        const day2 = dates[1];
        const day3 = dates[2];
        const day4 = dates[3];
        const day5 = dates[4];



        function isConsecutive(d1, d2) {
            return (d2 - d1) / (1000 * 60 * 60 * 24) === 1;
        }

        if (isConsecutive(day1, day2) && isConsecutive(day2, day3)) {
            task.status = 'started';
            task.claimAvailable = true;
            renderTasks();
            saveState();
        } else {
            showNotification("You need to collect daily rewards 3 days in a row!");
        }

        return;
    }
         // ‚úÖ Daily Reward 10-Day Streak Task
    if (task.id === 8) {
        const claimDays = JSON.parse(localStorage.getItem("dailyClaimDays") || "[]");

        // Convert to Date objects
        const dates = claimDays.map(d => new Date(d));

        if (dates.length < 10) {
            showNotification("‚ùå You need 10 daily rewards in a row!");
            return;
        }

        // ’é’•÷Ä’ª’´’∂ 10 ÷Ö÷Ä’•÷Ä’® sort-’•’∂÷Ñ ÷á ’Ω’ø’∏÷Ç’£’•’∂÷Ñ’ù ’°’∂’®’∂’§’¥’•’ª ’•’∂?
        dates.sort((a, b) => a - b);

        const day1 = dates[0];
        const day2 = dates[1];
        const day3 = dates[2];
        const day4 = dates[3];
        const day5 = dates[4];



        function isConsecutive(d1, d2) {
            return (d2 - d1) / (1000 * 60 * 60 * 24) === 1;
        }

        if (isConsecutive(day1, day2) && isConsecutive(day2, day3)) {
            task.status = 'started';
            task.claimAvailable = true;
            renderTasks();
            saveState();
        } else {
            showNotification("You need to collect daily rewards 10 days in a row!");
        }

        return;
    }
    // ‚úÖ Boost Channel task (ID 9)
    if (task.id === 9) {
        const boostLink = 'https://t.me/HyperrVersee?boost'; // ’ì’∏’≠’°÷Ä’´’∂’´÷Ä ÷Ñ’∏ channel boost ’∞’≤’∏÷Ç’¥’∏’æ
        window.open(boostLink, '_blank');

        // ’ç’Ø’Ω’∏÷Ç’¥ ’•’∂÷Ñ ’™’°’¥’°’∂’°’Ø’°’π’°÷É (÷Ö÷Ä’´’∂’°’Ø’ù 20’æ), ’∞’•’ø’∏ ’°’º’°’ª’°÷Ä’Ø’∏÷Ç’¥ Claim
        task.status = 'started';
        task.claimAvailable = false;

        task.timerId = setTimeout(() => {
            task.claimAvailable = true;
            renderTasks();
            saveState();
        }, 20000); // 20 ’æ’°’µ÷Ä’Ø’µ’°’∂

        renderTasks();
        saveState();
        return;
    }
if (task.id === 10) {
    let loginDays = JSON.parse(localStorage.getItem("loginDays") || "[]");

    // ’ç’∏÷Ä’ø’°’æ’∏÷Ä’•’¨ ’®’Ω’ø ÷Ö÷Ä’•÷Ä’´
    const dates = loginDays.map(d => new Date(d)).sort((a, b) => a - b);

    // ’ç’ø’∏÷Ç’£’•’∂÷Ñ’ù ’°÷Ä’§’µ’∏÷Ñ ’Ø’° 90 ’°’∂’®’∂’§’¥’•’ª ÷Ö÷Ä
    let streak = 1;
    for (let i = 1; i < dates.length; i++) {
        const diff = (dates[i] - dates[i - 1]) / (1000 * 60 * 60 * 24);
        if (diff === 1) {
            streak++;
        } else if (diff > 1) {
            streak = 1; // ’≠’¶’æ’•’¨ ’ß ’∑’°÷Ä÷Ñ’®
        }
    }

    if (streak >= 90) {
        task.status = 'started';
        task.claimAvailable = true;
        renderTasks();
        saveState();
    } else {
        showNotification(`‚ùå You need ${90 - streak} more day(s) to claim this task`);
    }

    return;
}

    // ‚úÖ ’Ñ’∂’°÷Å’°’Æ Task-’•÷Ä’´ ’∞’°’¥’°÷Ä ’©’∏’≤ ’¥’∂’° ’∂’∏÷Ç’µ’∂’®
    window.open(task.link, '_blank');
    task.status = 'started';
    task.claimAvailable = false;

    // ‚úÖ ’ç’∏’æ’∏÷Ä’°’Ø’°’∂ Task-’•÷Ä’´ ’∞’°’¥’°÷Ä
    window.open(task.link, '_blank');
    task.status = 'started';
    task.claimAvailable = false;

    task.timerId = setTimeout(() => {
        task.claimAvailable = true;
        renderTasks();
        saveState();
    }, 20000);

    renderTasks();
    saveState();
}


/**
 * Handle the Claim button click
 */
function handleClaim(taskId) {
    const taskIndex = tasks.findIndex(t => t.id === taskId);
    if (taskIndex === -1) return;
    
    const task = tasks[taskIndex];
    
    // Add reward to user score
    userScore += task.reward;
    updateScore();
    addToHistory(task.reward, `Claimed task: ${task.title}`);
    saveScoreHistory();
    showNotification(`You got +${task.reward} <i class="fas fa-star"></i>`);
    
    // Permanently mark this task as claimed
    permanentlyClaim(task.id);
    
    // Clear any timers
    if (task.timerId) {
        clearTimeout(task.timerId);
        task.timerId = null;
    }
    
    // Remove the task from the active tasks list
    tasks.splice(taskIndex, 1);
    
    saveState();
    renderTasks();
}

/**
 * Setup detection for changes to defaultTasks
 */
function setupTaskUpdateDetection() {
    // Save a stringified version of current defaultTasks for comparison
    taskUpdateListener = JSON.stringify(defaultTasks);
    
    // Create a periodic check for changes to defaultTasks
    setInterval(() => {
        const currentDefaultTasks = JSON.stringify(defaultTasks);
        if (currentDefaultTasks !== taskUpdateListener) {
            // defaultTasks has changed, reload tasks
            console.log("defaultTasks has been modified, refreshing tasks");
            taskUpdateListener = currentDefaultTasks;
            loadState(); // This will merge with any existing task state
        }
    }, 1000); // Check every second
}

/**
 * Check for new tasks in defaultTasks
 */
function checkForNewTasks() {
    const claimedTaskIds = JSON.parse(localStorage.getItem('claimedTaskIds') || '[]');
    
    // Check if there are any new tasks in defaultTasks that aren't in our current tasks
    const currentTaskIds = tasks.map(task => task.id);
    const newTasks = defaultTasks.filter(defaultTask => 
        !currentTaskIds.includes(defaultTask.id) && 
        !claimedTaskIds.includes(defaultTask.id)
    );
    
    // Also check for updates to existing tasks (title, reward, icon, etc.)
    let updatedTasksCount = 0;
    tasks.forEach((task, index) => {
        const defaultVersion = defaultTasks.find(dt => dt.id === task.id);
        if (defaultVersion) {
            // Check if any properties except status, claimAvailable, timerId have changed
            const taskCopy = {...task};
            const defaultCopy = {...defaultVersion};
            
            // Remove status properties for comparison
            delete taskCopy.status;
            delete taskCopy.claimAvailable;
            delete taskCopy.timerId;
            delete defaultCopy.status;
            delete defaultCopy.claimAvailable;
            delete defaultCopy.timerId;
            
            // If the properties are different, update the task
            if (JSON.stringify(taskCopy) !== JSON.stringify(defaultCopy)) {
                // Update task properties but preserve status
                const status = task.status;
                const claimAvailable = task.claimAvailable;
                const timerId = task.timerId;
                
                // Update with new properties
                tasks[index] = {...defaultVersion, 
                    status: status, 
                    claimAvailable: claimAvailable, 
                    timerId: timerId
                };
                
                updatedTasksCount++;
            }
        }
    });
    
    if (newTasks.length > 0 || updatedTasksCount > 0) {
        // Add new tasks to the current tasks list
        newTasks.forEach(newTask => {
            tasks.push({...newTask}); // Create a copy to avoid modifying defaults
        });
        
        // Save and render
        saveState();
        renderTasks();
        
        // Show appropriate notification
        if (newTasks.length > 0) {
            if (newTasks.length === 1) {
                showNotification(`New task available: ${newTasks[0].title}`);
            } else {
                showNotification(`${newTasks.length} new tasks available!`);
            }
        } else if (updatedTasksCount > 0) {
            showNotification(`${updatedTasksCount} task${updatedTasksCount > 1 ? 's' : ''} updated!`);
        }
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', () => {
    loadState();
    
    // Check for new tasks periodically (every 5 seconds)
    setInterval(checkForNewTasks, 5000);
    
    // Set up a mutation observer to detect changes to defaultTasks if it's modified directly
    setupTaskUpdateDetection();
});

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////





    // ’Ñ’´’°’æ’∏÷Ä’∂’•÷Ä’´ ’©’°÷Ä’¥’°÷Å’∏÷Ç’¥
function updateScore() {
  document.getElementById('userScore').textContent = userScore;
  localStorage.setItem('userScore', userScore);

  document.getElementById('userScoreDisplay').innerHTML = `${formatScore(userScore)} <i class="fas fa-star"></i>`;
  updateMedals(); // ‚úÖ ‘π’°÷Ä’¥’°÷Å’∂’•’∂÷Ñ ’¥’•’§’°’¨’∂’•÷Ä’® ’∂’∏÷Ç’µ’∂’∫’•’Ω
}



    // Tabs ÷É’∏’≠’¥’°’∂ ’ø÷Ä’°’¥’°’¢’°’∂’∏÷Ç’©’µ’∏÷Ç’∂
    function setupTabs() {
      const tabButtons = document.querySelectorAll('.tab-button');
      const tabContents = document.querySelectorAll('.tab-content');

      tabButtons.forEach(button => {
        button.addEventListener('click', () => {
          tabButtons.forEach(btn => btn.classList.remove('active'));
          tabContents.forEach(tc => tc.classList.remove('active'));

          const tab = button.getAttribute('data-tab');
          button.classList.add('active');
          document.getElementById(tab).classList.add('active');
        });
      });
    }

    // ¬´Close¬ª ’Ø’∏’≥’°’Ø’´ ’£’∏÷Ä’Æ’∏’≤’∏÷Ç’©’µ’∏÷Ç’∂’® (÷Ö÷Ä’´’∂’°’Ø’°’µ’´’∂)
    function setupCloseButton() {
      }

    // ‘≤’∏’¨’∏÷Ä ’¢’∏’æ’°’∂’§’°’Ø’∏÷Ç’©’µ’°’∂ ’Ω’Ø’¶’¢’∂’°’æ’∏÷Ä’∏÷Ç’¥’®
    function initApp() {
      loadScoreHistory();

      loadState();
      setupTabs();
      setupCloseButton();
      renderTasks();
      renderFriends();
      updateScore();
    }

    document.addEventListener('DOMContentLoaded', initApp);

     // ’ï’£’ø’°’ø’´÷Ä’∏’ª ’∫÷Ä’∏÷Ü’´’¨’´ ’ø’æ’µ’°’¨’∂’•÷Ä
     let userProfile = {
      score: localStorage.getItem("userScore") ? parseInt(localStorage.getItem("userScore")) : 0
    };

    function renderProfile() {
  const profileInfo = document.getElementById('profileInfo');

 

        window.Telegram.WebApp.ready();

    const user = window.Telegram.WebApp.initDataUnsafe?.user;


   profileInfo.innerHTML = `
  <h2 style="color: #fff; margin-bottom: 12px;"></h2>
  <div class="profile-item">
      <img 
      src="${Telegram.WebApp.initDataUnsafe.user.photo_url}" 
      class="profile-photo"
      alt="Profile photo"
    >
    <div class="profile-info">
      <span class="username">
        @${Telegram.WebApp.initDataUnsafe.user.username}
      </span>
     <span class="total-score">
  Total ${userProfile.score} <i class="fas fa-star"></i>
</span>
    </div>
  </div>


  <button class="sp-btn" onclick="window.location.href='paymentsup.html'">
    Support the project <i class="fas fa-hand-holding-usd"></i>
  </button>  

  <button class="delete-btn" onclick="showDeleteModal()">
    Delete All Data <i class="fas fa-trash-alt"></i>
  </button>

  <!-- Delete Confirmation Modal -->
  <div class="delete-modal">
    <div class="modal-content">
      <i class="fas fa-exclamation-triangle modal-icon"></i>
      <h3>Warning!</h3>
      <p>Are you sure you want to delete ALL data?<br>This action cannot be undone!</p>
      <div class="modal-buttons">
        <button class="modal-btn cancel-btn" onclick="closeDeleteModal()">
          <i class="fas fa-times"></i> Cancel
        </button>
        <button class="modal-btn confirm-btn" onclick="handleDeleteConfirm()">
          <i class="fas fa-trash"></i> Delete
        </button>
      </div>
    </div>
  </div>

  <!-- User Stats -->
  <div class="user-stats">
    <div class="stat-item">
      <i class="fas fa-users"></i>
      <span>Total Users: <strong id="total-users">34</strong></span>
    </div>
    <div class="stat-item">
      <i class="fas fa-user-check"></i>
      <span>Active Users: <strong id="active-users">12</strong></span>
    </div>
  </div>
`;
    }




     // ’ï’£’ø’°’ø’´÷Ä’∏’ª ’∫÷Ä’∏÷Ü’´’¨’´ ’ø’æ’µ’°’¨’∂’•÷Ä
     let userairdrop = {
      score: localStorage.getItem("userScore") ? parseInt(localStorage.getItem("userScore")) : 0
    };

  

    // ‘ª’∂’´÷Å’´’°’¨’´’¶’°÷Å’´’°
    function initApp() {
      loadScoreHistory();

      loadState();
      setupTabs();
      setupCloseButton();
      renderTasks();
      renderProfile(); // ’ì’∏’≠’æ’°’Æ ’ß renderFriends()-’´÷Å
      updateScore();
    }
    


    // ‘ª’∂’´÷Å’´’°’¨’´’¶’°÷Å’´’°
    function initApp() {
      loadScoreHistory();

      loadState();
      setupTabs();
      setupCloseButton();
      renderTasks();
      renderDailyReward(); // ’ì’∏’≠’æ’°’Æ ’ß
      renderProfile();
      updateScore();
    }



        const canvas = document.getElementById("starCanvas");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// ‘±’Ω’ø’≤’•÷Ä
const stars = [];
const numStars = 55;

for (let i = 0; i < numStars; i++) {
    stars.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        radius: Math.random() * 1,
        speed: Math.random() * 0.1 + 0.1,
        alpha: Math.random(),
        alphaDirection: Math.random() < 0.5 ? -1 : 1
    });
}



let lastTime = performance.now();

function draw(currentTime) {
    const delta = (currentTime - lastTime) / 16.67; // 1 frame ‚âà 16.67ms at 60FPS
    lastTime = currentTime;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // ‘±’Ω’ø’≤’•÷Ä
    stars.forEach((star) => {
        ctx.beginPath();
        ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(200, 200, 200, ${star.alpha})`;
        ctx.fill();

        // Adjust star position based on delta time
        star.y += star.speed * delta;

        if (star.y > canvas.height) {
            star.y = 0;
            star.x = Math.random() * canvas.width;
        }

        // ’ì’∏÷É’∏’≠’•’¨ alpha-’∂
        star.alpha += star.alphaDirection * 0.01 * delta;
        if (star.alpha <= 0 || star.alpha >= 1) {
            star.alphaDirection *= -1;
        }
    });

    requestAnimationFrame(draw);
}

requestAnimationFrame(draw);


function handleDailyQuest() {
    const lastClaimTime = localStorage.getItem(questCooldownKey);
    const now = new Date().getTime();
    const cooldownTime = 24 * 60 * 60 * 1000; // 24 ’™’°’¥

    if (lastClaimTime && now - lastClaimTime < cooldownTime) {
        document.getElementById("questMessage").innerText = "‚ùå You can enter the code again in 24 hours!";
        return;
    }

    const userCode = document.getElementById("dailyCodeInput").value;
    if (userCode === dailyCode) {
    document.getElementById("questMessage").innerHTML = "‚úÖ Correct code! You earned +750<i class='fas fa-star'></i>!";
    localStorage.setItem(questCooldownKey, now);
    
    // ‚úÖ Show notification with star icon
    showNotification(`+750 Claimed!`);
    
} else {
    document.getElementById("questMessage").innerText = "‚ùå Incorrect code! Try again.";
}
}

    document.querySelectorAll(".tab-button").forEach(button => {
        button.addEventListener("click", function () {
            // ’Ä’°’∂’∏÷Ç’¥ ’•’∂÷Ñ active ’§’°’Ω’® ’¢’∏’¨’∏÷Ä ’Ø’∏’≥’°’Ø’∂’•÷Ä’´÷Å
            document.querySelectorAll(".tab-button").forEach(btn => {
                btn.classList.remove("active");
                const img = btn.querySelector("img");
                const tabName = btn.getAttribute("data-tab");
                img.src = tabImages[tabName].default; // ’é’•÷Ä’°’§’°÷Ä’±’∂’∏÷Ç’¥ ’•’∂÷Ñ ’∂’∏÷Ä’¥’°’¨ ’∂’Ø’°÷Ä’®
            });

            // ‘±’æ’•’¨’°÷Å’∂’∏÷Ç’¥ ’•’∂÷Ñ active ’§’°’Ω’® ’Ω’•’≤’¥’æ’°’Æ ’Ø’∏’≥’°’Ø’´’∂
            this.classList.add("active");
            const img = this.querySelector("img");
            const tabName = this.getAttribute("data-tab");
            img.src = tabImages[tabName].active; // ’ì’∏’≠’∏÷Ç’¥ ’•’∂÷Ñ ’∂’Ø’°÷Ä’®
        });
    });

  </script>
 <script>
  document.getElementById("buyBtn").addEventListener("click", () => {
    Telegram.WebApp.openInvoice({
      slug: "give-stars-pack-1", // ’Ω’° ÷É’∏’≠’´÷Ä ÷Ñ’∏ slug-’∏’æ
      callback: function(status) {
        if (status === 'paid') {
          alert("’á’∂’∏÷Ä’∞’°’Ø’°’¨’∏÷Ç’©’µ’∏÷Ç’∂ ’£’∂’¥’°’∂ ’∞’°’¥’°÷Ä ‚≠ê");
          // ‘±’µ’Ω’ø’•’≤ ’Ø’°÷Ä’∏’≤ ’•’Ω ’°’æ’•’¨’°÷Å’∂’•’¨ Upgrade logic
          upgradePlayer(); // ÷Ö÷Ä’´’∂’°’Ø, level ’¢’°÷Ä’±÷Ä’°÷Å’∂’´
        }
      }
    });
  });

  function upgradePlayer() {
    // ’ï÷Ä’´’∂’°’Ø’ù playerLevel++ ’Ø’°’¥ skin ’¢’°÷Å’æ’´
    console.log("Player upgraded!");
  }
  function showNotification(message) {
  const notification = document.getElementById('notification');
  notification.textContent = message;
  notification.classList.remove('hidden', 'animate-out');
  notification.classList.add('animate-in');

  setTimeout(() => {
    notification.classList.remove('animate-in');
    notification.classList.add('animate-out');
    setTimeout(() => {
      notification.classList.add('hidden');
    }, 500);
  }, 2000);
}


function openPopup() {
  const popup = document.getElementById("popup");
  popup.style.display = "flex"; // ’æ’•÷Ä’§’°÷Ä’± display
  setTimeout(() => popup.classList.add("active"), 10); // ’¥’´ ÷É’∏÷Ñ÷Ä ’∏÷Ç’∑’°÷Å’∏÷Ç’¥ transition-’´ ’∞’°’¥’°÷Ä
}

  function closePopup() {
    const popup = document.getElementById("popup");
    popup.classList.add("closing");

    setTimeout(() => {
      popup.classList.remove("active", "closing");
      popup.style.display = "none";
    }, 300); // ’∞’°’¥’°’∫’°’ø’°’Ω’≠’°’∂ CSS transition ’™’°’¥’°’∂’°’Ø’® (0.3s)
  }


</script>
<script>
  
// Mystery Box Logic - Customizable Rewards
document.getElementById("mysteryBtn").onclick = () => {
    document.getElementById("mysteryPopup").style.display = "block";
};

document.querySelector(".close").onclick = () => {
    document.getElementById("mysteryPopup").style.display = "none";
};

// ‘ø’°÷Ä’£’°’æ’∏÷Ä’•’¨’´ reward-’∂’•÷Ä’´ ’ø’æ’µ’°’¨’∂’•÷Ä
const REWARD_SETTINGS = {
    tiers: [
        { 
            name: "Common", 
            chance: 0.6, // 60% ’∞’°’æ’°’∂’°’Ø’°’∂’∏÷Ç’©’µ’∏÷Ç’∂
            min: 2500, 
            max: 6000 
        },
        { 
            name: "Uncommon", 
            chance: 0.3, // 30% ’∞’°’æ’°’∂’°’Ø’°’∂’∏÷Ç’©’µ’∏÷Ç’∂
            min: 3000, 
            max: 7000 
        },
        { 
            name: "Rare", 
            chance: 0.1, // 10% ’∞’°’æ’°’∂’°’Ø’°’∂’∏÷Ç’©’µ’∏÷Ç’∂
            min: 10000, 
            max: 12000 
        },

         {
            name: "Legendary",
            chance: 0.05,
            min: 18000,
            max: 20000
          },
          {
            name: "imposibe",
            chance: 0.0005,
            min: 25000,
            max: 50000
          }
    ]
};

document.querySelectorAll(".box").forEach(box => {
    box.onclick = () => {
        const cost = parseInt(box.dataset.cost);
        if (userScore >= cost) {
            // Reward-’´ ’∞’°’∑’æ’°÷Ä’Ø’® ’∂’∏÷Ä ’ø÷Ä’°’¥’°’¢’°’∂’∏÷Ç’©’µ’°’¥’¢
            let random = Math.random();
            let cumulativeChance = 0;
            let selectedTier = REWARD_SETTINGS.tiers[0]; // Default
            
            for (const tier of REWARD_SETTINGS.tiers) {
                cumulativeChance += tier.chance;
                if (random <= cumulativeChance) {
                    selectedTier = tier;
                    break;
                }
            }
            
            const reward = Math.floor(
                Math.random() * (selectedTier.max - selectedTier.min + 1) 
                + selectedTier.min
            );

            userScore -= cost;
            addToHistory(-cost, `Opened ${box.classList.contains('gold') ? 'Gold' : 'Diamond'} Box`);

           userScore -= cost;
addToHistory(-cost, `Opened ${box.classList.contains('gold') ? 'Gold' : 'Diamond'} Box`);

userScore += reward;
addToHistory(reward, `Reward from ${selectedTier.name} tier`);
saveScoreHistory();
localStorage.setItem("userScore", userScore);

updateScore();

            
            Swal.fire({
    icon: 'success',
    title: 'üéâ Congratulations!',
    html: `You won ${reward} <i class="fas fa-star"></i> (${selectedTier.name} Reward)<br>
           <small>Total <i class="fas fa-star"></i>${userScore}</small>`,
    confirmButtonText: 'OK',
    customClass: {
        popup: 'reward-popup'
    }
});
} else {
Swal.fire({
    icon: 'error',
    title: 'üö´ Error',
    html: `You need ${cost} <i class="fas fa-star"></i><br>
           <small>Current <i class="fas fa-star"></i>${userScore}</small>`,
    confirmButtonText: 'OK',
    customClass: {
        popup: 'error-popup'
    }
            });
        }
    };
});
document.querySelector('.play-btn').addEventListener('click', function(e) {
  for(let i = 0; i < 8; i++) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    const rect = this.getBoundingClientRect();
    const angle = (Math.PI * 2 * i) / 8;
    particle.style.setProperty('--targetX', `${Math.cos(angle) * 50}px`);
    particle.style.setProperty('--targetY', `${Math.sin(angle) * 50}px`);
    particle.style.left = `${rect.width/2}px`;
    particle.style.top = `${rect.height/2}px`;
    this.appendChild(particle);
    setTimeout(() => particle.remove(), 1000);
  }
});


document.querySelector('.play-btn').addEventListener('click', function(e) {
  e.preventDefault();
  const btn = this;
  
  // ‘±’æ’•’¨’°÷Å’∂’∏÷Ç’¥ ’•’∂÷Ñ clicked ’Ø’¨’°’Ω’®
  btn.classList.add('clicked');
  
  // ‘ø’°’∂’•’∂÷Ñ body-’´ overflow hidden
  document.body.style.overflow = 'hidden';
  
  // ‘±’∂’´’¥’°÷Å’´’°’µ’´ ’°’æ’°÷Ä’ø’´÷Å ’∞’•’ø’∏ ’ø’°’∂’∏÷Ç’¥ ’•’∂÷Ñ game.html
  setTimeout(() => {
    window.location.href = 'game.html';
  }, 600); // ’Ä’°’¥’°’∫’°’ø’°’Ω’≠’°’∂’•÷Å÷Ä’•÷Ñ ’°’∂’´’¥’°÷Å’´’°’µ’´ ’ø÷á’∏’≤’∏÷Ç’©’µ’°’∂’® (0.6s)
  
  // Particle effects (’®’Ω’ø ÷Å’°’∂’Ø’∏÷Ç’©’µ’°’∂)
  for(let i = 0; i < 15; i++) {
    const particle = document.createElement('div');
    particle.style.cssText = `
      position: absolute;
      width: 8px;
      height: 8px;
      background: #00d0ff;
      border-radius: 50%;
      pointer-events: none;
      left: ${Math.random() * 100}%;
      top: ${Math.random() * 100}%;
      animation: explode 0.8s ease-out both;
    `;
    btn.appendChild(particle);
    setTimeout(() => particle.remove(), 800);
  }
});

// CSS ’°’∂’´’¥’°÷Å’´’° particle-’∂’•÷Ä’´ ’∞’°’¥’°÷Ä
const style = document.createElement('style');
style.textContent = `
@keyframes explode {
  0% { transform: scale(1); opacity: 1; }
  100% { transform: scale(3); opacity: 0; }
}`;
document.head.appendChild(style);
  </script>

<style>
.swal2-popup {
    font-size: 0,5rem !important;
    border-radius: 22px !important;
}
</style>
<!-- Delete Modal -->
<div class="delete-modal" style="display:none;">
  <!-- ’î’∏ modal ’¢’∏’æ’°’∂’§’°’Ø’∏÷Ç’©’µ’∏÷Ç’∂’® ’°’µ’Ω’ø’•’≤ -->
  <button onclick="handleDeleteConfirm()">Confirm Delete</button>
  <button onclick="closeDeleteModal()">Cancel</button>
</div>

<!-- Delete Popup -->
<div class="delete-popup" style="display:none;"></div>








<!-- Reward Info Popup -->
<div id="rewardPopup" class="popup" style="display:none;">
  <div class="popup-content">
    <h3>üèÖ All Medals</h3>
    <ul id="allMedalsList"></ul>
    <button onclick="closeRewardPopup()">Close</button>
  </div>
</div>


<script>
function openRewardPopup() {
  document.getElementById("rewardPopup").style.display = "block";
  const list = document.getElementById("allMedalsList");
  const medals = [
    { score: 100, emoji: '<i class="fas fa-medal" style="color: #cd7f32;"></i>', label: 'Bronze Medal' },
    { score: 10000, emoji: '<i class="fas fa-medal" style="color: #c0c0c0;"></i>', label: 'Silver Medal' },
    { score: 50000, emoji: '<i class="fas fa-medal" style="color: #ffd700;"></i>', label: 'Gold Medal' },
    { score: 150000, emoji: '<i class="fas fa-trophy" style="color: #e5e4e2;"></i>', label: 'Platinum Medal' },
    { score: 500000, emoji: '<i class="fas fa-gem" style="color: #b9f2ff;"></i>', label: 'Diamond Medal' },
    { score: 1000000, emoji: '<i class="fas fa-trophy" style="color: gold;"></i>', label: 'Millionaire Medal' },
    { score: 5000000, emoji: '<i class="fas fa-crown" style="color: #ffd700;"></i>', label: 'Legend Medal' },
    { score: 10000000, emoji: '<i class="fas fa-infinity" style="color: #4b0082;"></i>', label: 'God Mode Medal' }
  ];
  list.innerHTML = medals.map(m => `<li>${m.emoji} ${m.label} ‚Äî ${formatScore(m.score)}+</li>`).join("");
}
function closeRewardPopup() {
  document.getElementById("rewardPopup").style.display = "none";
}
async function sendScoreToServer() {
  const tgUser = Telegram.WebApp.initDataUnsafe.user;
  const score = userScore; // ’Ω’° ’°÷Ä’§’•’∂ ’Ø’° ÷Ñ’∏ ’Ø’∏’§’∏÷Ç’¥

  const body = {
    id: tgUser.id.toString(),
    username: tgUser.username,
    newScore: score
  };

  try {
    const res = await fetch("http://localhost:3000/update-score", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body)
    });

    const data = await res.json();
    console.log("‚úÖ Server response:", data);
  } catch (err) {
    console.error("‚ùå Failed to update score:", err);
  }
}

</script>

</body>
</html>

<!-- <script src="phoneweb.js"></script>
<script>
  if (Telegram.WebApp.platform !== 'android' && Telegram.WebApp.platform !== 'ios') {
    document.body.innerHTML = `
      <style>
        body {
          margin: ;
          padding: 10px;
          font-family: Arial, sans-serif;
          background:rgb(0, 0, 0);
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          height: 100vh;
          text-align: center;
        }
  
        .message {
          max-width: 400px;
        }
  
        img {
          margin-top: 25px;
          width: 200px;
          height: 200px;
        }
          po{
              font-weight: bold;}

       
      </style>
  
      <div class="message">
        <h2>Please open the game on your phone.</h2>
        <p class = po >Open this QR code with your phone to start the game.</p>
        <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://t.me/hyperrverse_bot" alt="QR Code">
      </div>
    `;
  }
  window.addEventListener("load", () => {
    if (typeof Telegram === 'undefined' || typeof Telegram.WebApp === 'undefined') {
      document.body.innerHTML = `
        <style>
          body {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
            background-color: black;
            text-align: center;
            font-family: Arial, sans-serif;
          }
          img {
            margin-top: 20px;
            width: 200px;
            height: 200px;
          }
            p{
                          font-weight: bold;}

            }
        </style>
        <h2>The game can only be opened from within Telegram.</h2>
        <p>Use the Telegram bot to play</p>
        <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://t.me/hyperrverse_bot" alt="QR Code">
      `;
    } else {
      // Telegram WebApp ’¥’´’ª’°’æ’°’µ÷Ä’∂ ’ß’ù ’°’µ’Ω’ø’•’≤’´÷Å ’©’∏’≤ ’£’∏÷Ä’Æ’´ ÷Ñ’∏ ’≠’°’≤’®
      console.log("‘≤’°÷Å’æ’•’¨ ’ß Telegram-’´ ’¥’´’ª’∏’æ ‚úÖ");
    }
  });

</script>



